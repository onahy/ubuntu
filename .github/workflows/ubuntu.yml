name: Ubuntu VDS

on: workflow_dispatch

jobs:
  vds:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      max-parallel: 2
      matrix:
        instance: [1, 2]
    name: VDS Instance ${{ matrix.instance }}
    timeout-minutes: 360
    
    steps:
    - name: Hızlı Kurulum
      run: |
        sudo apt-get update -qq > /dev/null 2>&1
        sudo apt-get install -y tmate -qq > /dev/null 2>&1
        
    - name: SSH Bağlantısı Oluştur
      run: |
        tmate -S /tmp/tmate.sock new-session -d
        tmate -S /tmp/tmate.sock wait tmate-ready
        echo "🖥️ VDS #${{ matrix.instance }}:"
        tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'
        
    - name: Çalışır Tut
      run: |
        while true; do
          sleep 300
          if ! tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}' > /dev/null 2>&1; then
            exit 1
          fi
        done 
